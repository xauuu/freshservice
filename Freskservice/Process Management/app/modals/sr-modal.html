<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.7.0/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="../styles/style.css">
</head>

<body>
    <form id="formCreate" class="h-screen flex flex-col justify-between">
        <div class="grid gap-4 mb-4 sm:grid-cols-2 p-1 overflow-y-auto">
            <div>
                <label for="awesomplete" class="block mb-2 text-xs font-medium text-gray-900 ">Service Item
                    <span class="text-red-700 text-md">*</span>
                </label>
                <select id="service_item_id" name="service_item_id" required
                    class="font-medium border border-gray-300 text-gray-900 text-xs rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full px-2.5 py-2">
                    <option value="" selected disabled>Choose a Service Item</option>
                </select>
                <!-- <input type="text" id="awesomplete"
                    class="border border-gray-300 text-gray-900 font-medium text-xs rounded-md focus:ring-primary-600 focus:border-primary-600 w-full px-2.5 py-2"
                    placeholder="Enter Details" required="">
                <input type="hidden" name="service_item_id" id="service_item_id"> -->
            </div>
            <div>
                <label for="app_code" class="block mb-2 text-xs font-medium text-gray-900 ">App Code
                    <span class="text-red-700 text-md">*</span>
                </label>
                <input type="text" name="app_code" id="app_code"
                    class="border border-gray-300 text-gray-900 font-medium text-xs rounded-md focus:ring-primary-600 focus:border-primary-600 block w-full px-2.5 py-2"
                    placeholder="Enter Details" required="">
            </div>
            <div>
                <label for="app_name" class="block mb-2 text-xs font-medium text-gray-900">App Name
                    <span class="text-red-700 text-md">*</span>
                </label>
                <input type="text" name="app_name" id="app_name"
                    class="border border-gray-300 text-gray-900 font-medium text-xs rounded-md focus:ring-primary-600 focus:border-primary-600 block w-full px-2.5 py-2"
                    placeholder="Enter Details" required="">
            </div>
            <div>
                <label for="app_image" class="block mb-2 text-xs font-medium text-gray-900">
                    App Image SVG
                    <span class="text-red-700 text-md">*</span>
                </label>
                <textarea id="app_image" name="app_image" rows="4"
                    class="block px-2.5 py-2 w-full text-xs text-gray-900 font-medium rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Enter Details..."></textarea>
            </div>
            <div>
                <label for="process_code" class="block mb-2 text-xs font-medium text-gray-900">Process Code
                    <span class="text-red-700 text-md">*</span>
                </label>
                <input type="text" name="process_code" id="process_code"
                    class="border border-gray-300 text-gray-900 font-medium text-xs rounded-md focus:ring-primary-600 focus:border-primary-600 block w-full px-2.5 py-2"
                    placeholder="Enter Details" required="">
            </div>
            <div>
                <label for="process_name" class="block mb-2 text-xs font-medium text-gray-900">Process Name
                    <span class="text-red-700 text-md">*</span>
                </label>
                <input type="text" name="process_name" id="process_name"
                    class="border border-gray-300 text-gray-900 font-medium text-xs rounded-md focus:ring-primary-600 focus:border-primary-600 block w-full px-2.5 py-2"
                    placeholder="Enter Details" required="">
            </div>
            <div>
                <label for="process_image" class="block mb-2 text-xs font-medium text-gray-900">Process Image SVG
                    <span class="text-red-700 text-md">*</span>
                </label>
                <textarea id="process_image" name="process_image" rows="4"
                    class="block px-2.5 py-2 w-full text-xs text-gray-900 font-medium rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Enter Details..."></textarea>
            </div>
            <div>
                <label for="process_description" class="block mb-2 text-xs font-medium text-gray-900">Process
                    Description
                    <span class="text-red-700 text-md">*</span>
                </label>
                <textarea id="process_description" name="process_description" rows="4"
                    class="block px-2.5 py-2 w-full text-xs text-gray-900 font-medium rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Enter Details..."></textarea>
            </div>
            <div>
                <label for="process_url" class="block mb-2 text-xs font-medium text-gray-900">Process URL
                    <span class="text-red-700 text-md">*</span>
                </label>
                <input type="text" name="process_url" id="process_url"
                    class="border border-gray-300 text-gray-900 font-medium text-xs rounded-md focus:ring-primary-600 focus:border-primary-600 block w-full px-2.5 py-2"
                    placeholder="Enter Details" required="">
            </div>
            <div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input name="is_active" id="is_active" type="checkbox" value="1" class="sr-only peer">
                    <div
                        class="w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600">
                    </div>

                    <span class="ml-3 text-xs font-medium text-gray-900 dark:text-gray-300">Is Active</span>
                </label>
            </div>
        </div>
        <div class="flex gap-4 justify-end mb-1"> <button id="closeModal" type="button"
                class="inline-flex items-center border border-gray-300 rounded-md hover:bg-gray-100 font-medium text-xs px-5 py-1.5 text-center">
                Cancel
            </button>
            <button id="create" type="submit"
                class="inline-flex items-center text-white border border-blue-800 bg-blue-800 hover:bg-blue-900 font-medium rounded-md text-xs px-5 py-1.5 text-center">
                Save
            </button>
        </div>
    </form>
    <script src="https://static.freshdev.io/fdk/2.0/assets/fresh_client.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.7.0/flowbite.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="../scripts/jquery.select-to-autocomplete.js"></script>
    <script src="../scripts/constant.js"></script>
    <script>
        window.frsh_init().then(function (client) {
            var context = {}
            $("#closeModal").click(function () {
                client.instance.close();
            });
            $("#formCreate").submit(function (e) {
                e.preventDefault();
                const data = new FormData(e.target);
                const formDataObj = {
                    is_active: 0
                };
                for (let entry of data.entries()) {
                    const [key, value] = entry;
                    formDataObj[key] = value;
                }
                console.log(formDataObj)
                client.instance.send({
                    message: {
                        type: context.type,
                        data: formDataObj,
                        id: context.data?.bo_display_id
                    }
                });
            });
            client.instance.receive(function (event) {
                let data = event.helper.getData();
                if (data.type === ACTION_TYPES.CLOSE_MODAL) client.instance.close();
                if (data.type === ACTION_TYPES.LIST_DATA) {
                    generateSelect("service_item_id", data.data.serviceItems, context)
                    $('#service_item_id').selectToAutocomplete();
                }
            });
            client.instance.context().then(
                function (c) {
                    context = c.data
                    if (context.type === ACTION_TYPES.SERVICE_REQUEST_UPDATE) {
                        const data = context.data
                        document.getElementById("service_item_id").value = data.service_item_id;
                        document.getElementById("app_code").value = data.app_code;
                        document.getElementById("app_name").value = data.app_name;
                        document.getElementById("app_image").value = data.app_image;
                        document.getElementById("process_code").value = data.process_code;
                        document.getElementById("process_name").value = data.process_name;
                        document.getElementById("process_image").value = data.process_image;
                        document.getElementById("process_url").value = data.process_url;
                        document.getElementById("process_description").value = data.process_description;
                        document.getElementById("is_active").checked = !!data.is_active;
                    }
                }
            );
        });
        function generateSelect(container, list, context) {
            list?.forEach((item) => {
                const { display_id, name } = item;
                const option = document.createElement('option')
                option.value = display_id
                option.text = name
                option.selected = context.data?.service_item_id == display_id
                document.getElementById(container).append(option)
            });
        }
    </script>
</body>

</html>