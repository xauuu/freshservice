<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../styles/style.css">
</head>

<body>
    <div id="static-form-container">
        <fw-form id="formCreate">
            <fw-form-control type="DROPDOWN" id="service_item_id" name="service_item_id" label="Service Item"
                required="true" placeholder="Select Service Item"></fw-form-control>
            <fw-form-control id="app_code" name="app_code" label="App Code" required="true"
                placeholder="Enter App Code"></fw-form-control>
            <fw-form-control id="app_name" name="app_name" label="App Name" required="true"
                placeholder="Enter App Name"></fw-form-control>
            <fw-form-control type="PARAGRAPH" id="app_image" name="app_image" rows=3 maxlength=190 minlength=5
                label="Enter App Image SVG" placeholder="App Image SVG">
            </fw-form-control>
            <fw-form-control id="process_code" name="process_code" label="Enter Process Code" required="true"
                placeholder="Process Code"></fw-form-control>
            <fw-form-control id="process_name" name="process_name" label="Enter Process Name" required="true"
                placeholder="Process Name"></fw-form-control>
            <fw-form-control id="process_url" name="process_url" label="Process_URL" required="true"
                placeholder="Enter Process_URL"></fw-form-control>
            <fw-form-control type="PARAGRAPH" id="process_image" name="process_image" rows=3 maxlength=190 minlength=5
                label="Process Image SVG" placeholder="Enter Process Image SVG">
            </fw-form-control>
            <fw-form-control type="PARAGRAPH" id="process_description" name="process_description" rows=3 maxlength=190
                minlength=5 label="Description" placeholder="Enter Description">
            </fw-form-control>
            <fw-form-control type="CHECKBOX" id="is_active" name="is_active" label="Is Active"></fw-form-control>
        </fw-form>
        <div class="bottom">
            <fw-button id="closeModal" color="secondary">Close</fw-button>
            <fw-button id="submit" color="primary">Save</fw-button>
        </div>
    </div>

    <script src="https://static.freshdev.io/fdk/2.0/assets/fresh_client.js"></script>
    <script type="module"
        src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.js"></script>
    <script src="../scripts/constant.js"></script>
    <script>
        window.frsh_init().then(function (client) {
            var context = {}
            var formCreate = document.querySelector("#formCreate")
            document.getElementById("closeModal").addEventListener('click', function () {
                client.instance.close();
            })
            document.querySelector('#submit').addEventListener('click', async (e) => {
                const { values, isValid } = await formCreate.doSubmit(e);
                console.log(values)
                client.instance.send({
                    message: {
                        type: context.type,
                        data: values,
                        id: context.detail?.bo_display_id
                    }
                });

            });
            client.instance.receive(function (event) {
                let data = event.helper.getData();
                if (data.type === ACTION_TYPES.CLOSE_MODAL) client.instance.close();
            });
            client.instance.context().then(
                function (c) {
                    context = c.data
                    if (context.type === ACTION_TYPES.SERVICE_REQUEST_CREATE || context.type === ACTION_TYPES.SERVICE_REQUEST_UPDATE) {
                        const { detail, data } = context
                        generateSelect("service_item_id", data.serviceItems, context)
                        if (!detail) return
                        Object.keys(detail).forEach(function (key) {
                            formCreate.setFieldValue([key], detail[key]);
                        });
                    }
                }
            );
        });
        function generateSelect(container, list, context) {
            const options = list?.map((item) => {
                return { value: String(item.display_id), text: item.name };
            });
            document.getElementById(container).choices = options
            document.getElementById(container).value = String(context.detail?.service_item_id)
        }
    </script>
</body>

</html>